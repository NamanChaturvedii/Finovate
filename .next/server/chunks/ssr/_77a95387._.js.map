{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/wealth/actions/account.js"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from \"@/lib/prisma\";\r\nimport { auth } from \"@clerk/nextjs/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nconst serializeDecimal = (obj) => {\r\n    const serialized = { ...obj };\r\n    if (obj.balance) {\r\n        serialized.balance = obj.balance.toNumber();\r\n    }\r\n    if (obj.amount) {\r\n        serialized.amount = obj.amount.toNumber();\r\n    }\r\n    return serialized;\r\n};\r\n\r\nexport async function getAccountWithTransactions(accountId) {\r\n    const { userId } = await auth();\r\n    if (!userId) throw new Error(\"Unauthorized\");\r\n\r\n    const user = await db.user.findUnique({\r\n        where: { clerkUserId: userId },\r\n    });\r\n\r\n    if (!user) throw new Error(\"User not found\");\r\n\r\n    const account = await db.account.findUnique({\r\n        where: {\r\n            id: accountId,\r\n            userId: user.id,\r\n        },\r\n        include: {\r\n            transactions: {\r\n                orderBy: { date: \"desc\" },\r\n            },\r\n            _count: {\r\n                select: { transactions: true },\r\n            },\r\n        },\r\n    });\r\n\r\n    if (!account) return null;\r\n\r\n    return {\r\n        ...serializeDecimal(account),\r\n        transactions: account.transactions.map(serializeDecimal),\r\n    };\r\n}\r\n\r\nexport async function bulkDeleteTransactions(transactionIds) {\r\n    try {\r\n        const { userId } = await auth();\r\n        if (!userId) throw new Error(\"Unauthorized\");\r\n\r\n        const user = await db.user.findUnique({\r\n            where: { clerkUserId: userId },\r\n        });\r\n\r\n        if (!user) throw new Error(\"User not found\");\r\n\r\n        // Get transactions to calculate balance changes\r\n        const transactions = await db.transaction.findMany({\r\n            where: {\r\n                id: { in: transactionIds },\r\n                userId: user.id,\r\n            },\r\n        });\r\n\r\n        // Group transactions by account to update balances\r\n        const accountBalanceChanges = transactions.reduce((acc, transaction) => {\r\n            const change =\r\n                transaction.type === \"EXPENSE\"\r\n                    ? transaction.amount\r\n                    : -transaction.amount;\r\n            acc[transaction.accountId] = (acc[transaction.accountId] || 0) + change;\r\n            return acc;\r\n        }, {});\r\n\r\n        // Delete transactions and update account balances in a transaction\r\n        await db.$transaction(async (tx) => {\r\n            // Delete transactions\r\n            await tx.transaction.deleteMany({\r\n                where: {\r\n                    id: { in: transactionIds },\r\n                    userId: user.id,\r\n                },\r\n            });\r\n\r\n            // Update account balances\r\n            for (const [accountId, balanceChange] of Object.entries(\r\n                accountBalanceChanges\r\n            )) {\r\n                await tx.account.update({\r\n                    where: { id: accountId },\r\n                    data: {\r\n                        balance: {\r\n                            increment: balanceChange,\r\n                        },\r\n                    },\r\n                });\r\n            }\r\n        });\r\n\r\n        revalidatePath(\"/dashboard\");\r\n        revalidatePath(\"/account/[id]\");\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateDefaultAccount(accountId) {\r\n    try {\r\n        const { userId } = await auth();\r\n        if (!userId) throw new Error(\"Unauthorized\");\r\n\r\n        const user = await db.user.findUnique({\r\n            where: { clerkUserId: userId },\r\n        });\r\n\r\n        if (!user) {\r\n            throw new Error(\"User not found\");\r\n        }\r\n\r\n        // First, unset any existing default account\r\n        await db.account.updateMany({\r\n            where: {\r\n                userId: user.id,\r\n                isDefault: true,\r\n            },\r\n            data: { isDefault: false },\r\n        });\r\n\r\n        // Then set the new default account\r\n        const account = await db.account.update({\r\n            where: {\r\n                id: accountId,\r\n                userId: user.id,\r\n            },\r\n            data: { isDefault: true },\r\n        });\r\n\r\n        revalidatePath(\"/dashboard\");\r\n        return { success: true, data: serializeTransaction(account) };\r\n    } catch (error) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///D:/wealth/app/%28main%29/account/%5Bid%5D/page.jsx"],"sourcesContent":["// import { Suspense } from \"react\";\r\nimport { getAccountWithTransactions } from \"@/actions/account\";\r\n// import { BarLoader } from \"react-spinners\";\r\n// import { TransactionTable } from \"../_components/transaction-table\";\r\nimport { notFound } from \"next/navigation\";\r\n// import { AccountChart } from \"../_components/account-chart\";\r\n\r\nexport default async function AccountPage({ params }) {\r\n    const accountData = await getAccountWithTransactions(params.id);\r\n\r\n    if (!accountData) {\r\n        notFound();\r\n    }\r\n\r\n    const { transactions, ...account } = accountData;\r\n\r\n    return (\r\n        <div className=\"space-y-8 px-5\">\r\n            <div className=\"flex gap-4 items-end justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-5xl sm:text-6xl font-bold tracking-tight gradient-title capitalize\">\r\n                        {account.name}\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground\">\r\n                        {account.type.charAt(0) + account.type.slice(1).toLowerCase()}{\" \"}\r\n                        Account\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"text-right pb-2\">\r\n                    <div className=\"text-xl sm:text-2xl font-bold\">\r\n                        ${parseFloat(account.balance).toFixed(2)}\r\n                    </div>\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                        {account._count.transactions} Transactions\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Chart Section */}\r\n            {/* <Suspense\r\n                fallback={<BarLoader className=\"mt-4\" width={\"100%\"} color=\"#9333ea\" />}\r\n            >\r\n                <AccountChart transactions={transactions} />\r\n            </Suspense> */}\r\n\r\n            {/* Transactions Table */}\r\n            {/* <Suspense\r\n                fallback={<BarLoader className=\"mt-4\" width={\"100%\"} color=\"#9333ea\" />}\r\n            >\r\n                <TransactionTable transactions={transactions} />\r\n            </Suspense> */}\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"AAAA,oCAAoC;;;;;AACpC;AACA,8CAA8C;AAC9C,uEAAuE;AACvE;AAAA;;;;AAGe,eAAe,YAAY,EAAE,MAAM,EAAE;IAChD,MAAM,cAAc,MAAM,CAAA,GAAA,kHAAA,CAAA,6BAA0B,AAAD,EAAE,OAAO,EAAE;IAE9D,IAAI,CAAC,aAAa;QACd,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD;IACX;IAEA,MAAM,EAAE,YAAY,EAAE,GAAG,SAAS,GAAG;IAErC,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAI,WAAU;;8BACX,8OAAC;;sCACG,8OAAC;4BAAG,WAAU;sCACT,QAAQ,IAAI;;;;;;sCAEjB,8OAAC;4BAAE,WAAU;;gCACR,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,QAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,WAAW;gCAAI;gCAAI;;;;;;;;;;;;;8BAK3E,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,WAAU;;gCAAgC;gCACzC,WAAW,QAAQ,OAAO,EAAE,OAAO,CAAC;;;;;;;sCAE1C,8OAAC;4BAAE,WAAU;;gCACR,QAAQ,MAAM,CAAC,YAAY;gCAAC;;;;;;;;;;;;;;;;;;;;;;;;AAoBrD","debugId":null}}]
}