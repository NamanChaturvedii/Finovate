{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/wealth/actions/dashboard.js"],"sourcesContent":["\"use server\"\r\n\r\n\r\n// import aj from \"@/lib/arcjet\";\r\nimport { db } from \"@/lib/prisma\";\r\n// import { request } from \"@arcjet/next\";\r\nimport { auth } from \"@clerk/nextjs/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n\r\nconst serializeTransaction = (obj) => {\r\n    const serialized = { ...obj };\r\n    if (obj.balance) {\r\n        serialized.balance = obj.balance.toNumber();\r\n    }\r\n        if (obj.amount) {\r\n        serialized.amount = obj.amount.toNumber();\r\n    }\r\n};\r\n\r\n\r\nexport async function createAccount(data) {\r\n    try {\r\n        const { userId } = await auth();\r\n        if (!userId) throw new Error(\"unthorized\");\r\n\r\n        const user = await db.user.findUnique({\r\n            where: { clerkUserId: userId },\r\n        });\r\n\r\n        if (!user) {\r\n            throw new Error(\"user not found\");\r\n        }\r\n\r\n        // convert bablcnce\r\n        const balanceFloat = parseFloat(data.balance)\r\n        if (isNaN(balanceFloat)) {\r\n            throw new Error(\"invalid balance amount\");\r\n        }\r\n\r\n        // check if this is the user first account\r\n\r\n        const existingAccounts = await db.account.findMany({\r\n            where: { userId: user.id },\r\n        })\r\n\r\n        const shouldBeDefault =\r\n            existingAccounts.length === 0 ? true : data.isDefault;\r\n        // if this is defalut account undo all the remaing account\r\n        if (shouldBeDefault) {\r\n            await db.account.updateMany({\r\n                where: { userId: user.id, isDefault: true },\r\n                data: { isDefault: false },\r\n            });\r\n        }\r\n\r\n        // new account\r\n        const account = await db.account.create({\r\n            data: {\r\n                ...data,\r\n                balance: balanceFloat,\r\n                userId: user.id,\r\n                isDefault: shouldBeDefault,\r\n            }\r\n        });\r\n\r\n        const serialacc = serializeTransaction(account);\r\n        revalidatePath(\"/dashboard\");\r\n        return { success: true, data: serialacc };\r\n\r\n    } catch (error) {\r\n        throw new Error(error.message);\r\n    }\r\n}\r\n\r\n\r\nexport async function getUserAccounts() {\r\n    const { userId } = await auth();\r\n    if (!userId) throw new Error(\"Unauthorized\");\r\n\r\n    const user = await db.user.findUnique({\r\n        where: { clerkUserId: userId },\r\n    });\r\n\r\n    if (!user) {\r\n        throw new Error(\"User not found\");\r\n    }\r\n\r\n    try {\r\n        const accounts = await db.account.findMany({\r\n            where: { userId: user.id },\r\n            orderBy: { createdAt: \"desc\" },\r\n            include: {\r\n                _count: {\r\n                    select: {\r\n                        transactions: true,\r\n                    },\r\n                },\r\n            },\r\n        });\r\n\r\n        const serializedAccounts = accounts.map(serializeTransaction);\r\n\r\n        return serializedAccounts;\r\n    } catch (error) {\r\n        console.error(error.message);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAGA,iCAAiC;AACjC;AACA,0CAA0C;AAC1C;AACA;;;;;;;AAGA,MAAM,uBAAuB,CAAC;IAC1B,MAAM,aAAa;QAAE,GAAG,GAAG;IAAC;IAC5B,IAAI,IAAI,OAAO,EAAE;QACb,WAAW,OAAO,GAAG,IAAI,OAAO,CAAC,QAAQ;IAC7C;IACI,IAAI,IAAI,MAAM,EAAE;QAChB,WAAW,MAAM,GAAG,IAAI,MAAM,CAAC,QAAQ;IAC3C;AACJ;AAGO,eAAe,cAAc,IAAI;IACpC,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA,GAAA,mLAAA,CAAA,OAAI,AAAD;QAC5B,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;QAE7B,MAAM,OAAO,MAAM,6GAAA,CAAA,KAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YAClC,OAAO;gBAAE,aAAa;YAAO;QACjC;QAEA,IAAI,CAAC,MAAM;YACP,MAAM,IAAI,MAAM;QACpB;QAEA,mBAAmB;QACnB,MAAM,eAAe,WAAW,KAAK,OAAO;QAC5C,IAAI,MAAM,eAAe;YACrB,MAAM,IAAI,MAAM;QACpB;QAEA,0CAA0C;QAE1C,MAAM,mBAAmB,MAAM,6GAAA,CAAA,KAAE,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;QAC7B;QAEA,MAAM,kBACF,iBAAiB,MAAM,KAAK,IAAI,OAAO,KAAK,SAAS;QACzD,0DAA0D;QAC1D,IAAI,iBAAiB;YACjB,MAAM,6GAAA,CAAA,KAAE,CAAC,OAAO,CAAC,UAAU,CAAC;gBACxB,OAAO;oBAAE,QAAQ,KAAK,EAAE;oBAAE,WAAW;gBAAK;gBAC1C,MAAM;oBAAE,WAAW;gBAAM;YAC7B;QACJ;QAEA,cAAc;QACd,MAAM,UAAU,MAAM,6GAAA,CAAA,KAAE,CAAC,OAAO,CAAC,MAAM,CAAC;YACpC,MAAM;gBACF,GAAG,IAAI;gBACP,SAAS;gBACT,QAAQ,KAAK,EAAE;gBACf,WAAW;YACf;QACJ;QAEA,MAAM,YAAY,qBAAqB;QACvC,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE;QACf,OAAO;YAAE,SAAS;YAAM,MAAM;QAAU;IAE5C,EAAE,OAAO,OAAO;QACZ,MAAM,IAAI,MAAM,MAAM,OAAO;IACjC;AACJ;AAGO,eAAe;IAClB,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA,GAAA,mLAAA,CAAA,OAAI,AAAD;IAC5B,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAE7B,MAAM,OAAO,MAAM,6GAAA,CAAA,KAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QAClC,OAAO;YAAE,aAAa;QAAO;IACjC;IAEA,IAAI,CAAC,MAAM;QACP,MAAM,IAAI,MAAM;IACpB;IAEA,IAAI;QACA,MAAM,WAAW,MAAM,6GAAA,CAAA,KAAE,CAAC,OAAO,CAAC,QAAQ,CAAC;YACvC,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;YACzB,SAAS;gBAAE,WAAW;YAAO;YAC7B,SAAS;gBACL,QAAQ;oBACJ,QAAQ;wBACJ,cAAc;oBAClB;gBACJ;YACJ;QACJ;QAEA,MAAM,qBAAqB,SAAS,GAAG,CAAC;QAExC,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,MAAM,OAAO;IAC/B;AACJ;;;IAtFsB;IAuDA;;AAvDA,+OAAA;AAuDA,+OAAA","debugId":null}}]
}